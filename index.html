<!doctype html>
<html lang="cs">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Asistent obce Radim</title>

<style>
body {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: transparent;
}

/* === PLATNÝ CHAT WIDGET === */
.chat-widget {
  position: fixed;
  right: 24px;
  bottom: 24px;
  width: 360px;
  max-height: 540px;
  background: #ffffff;
  border-radius: 16px;
  box-shadow: 0 12px 35px rgba(0,0,0,.18);
  display: flex;
  flex-direction: column;
  overflow: hidden;
  border: 1px solid #e5e7eb;
  z-index: 9999;
}

.chat-header {
  background: #1e3a8a;
  color: #fff;
  padding: 12px 14px;
  font-weight: 700;
  font-size: 16px;
}

.chat {
  display: flex;
  flex-direction: column;
  gap: 8px;
  padding: 12px;
  overflow-y: auto;
  flex: 1;
  background: #f8fafc;
}

.msg {
  padding: 8px 10px;
  border-radius: 10px;
  font-size: 14px;
  line-height: 1.35;
  white-space: pre-wrap;
}

.me {
  background: #dbeafe;
  align-self: flex-end;
}

.bot {
  background: #ffffff;
  border: 1px solid #e5e7eb;
  align-self: flex-start;
}

.ai-note {
  font-size: 11px;
  background: #fef3c7;
  border: 1px solid #fde68a;
  color: #92400e;
  border-radius: 8px;
  padding: 8px;
}

.row {
  display: flex;
  border-top: 1px solid #e5e7eb;
}

input {
  flex: 1;
  padding: 10px;
  border: none;
  font-size: 14px;
  outline: none;
}

button {
  padding: 0 14px;
  border: 0;
  background: #1e3a8a;
  color: #fff;
  font-weight: 600;
  cursor: pointer;
}

button:disabled {
  opacity: .6;
  cursor: not-allowed;
}
</style>
</head>

<body>

<div class="chat-widget">
  <div class="chat-header">Asistent obce Radim</div>

  <div id="chat" class="chat"></div>

  <div class="row">
    <input id="q" type="text" placeholder="Napište dotaz…" autocomplete="off" />
    <button id="send">›</button>
  </div>
</div>

<script>
const chatEl = document.getElementById("chat");
const inputEl = document.getElementById("q");
const sendBtn = document.getElementById("send");

function addMessage(who, text, cls) {
  const div = document.createElement("div");
  div.className = "msg " + cls;
  div.textContent = `${who}: ${text}`;
  chatEl.appendChild(div);
  chatEl.scrollTop = chatEl.scrollHeight;
}

function addAiNote() {
  const div = document.createElement("div");
  div.className = "ai-note";
  div.textContent =
    "Upozornění: Odpověď je generována umělou inteligencí a má informativní charakter. Pro oficiální a závazné informace doporučujeme ověřit údaje na oficiálním webu obce Radim.";
  chatEl.appendChild(div);
}

async function ask() {
  const query = inputEl.value.trim();
  if (!query) return;

  addMessage("Vy", query, "me");
  inputEl.value = "";
  sendBtn.disabled = true;

  try {
    const res = await fetch("/.netlify/functions/search", {
      method: "POST",
      headers: { "content-type": "application/json" },
      body: JSON.stringify({ message: query }) // ⚠️ ponecháno
    });

    const raw = await res.text();
    const data = JSON.parse(raw);

    if (!res.ok || !data.ok) {
      addMessage("Radim", data?.error || "Chyba serveru", "bot");
      return;
    }

    addMessage("Radim", data.answer || "(bez odpovědi)", "bot");
    addAiNote();

  } catch (e) {
    addMessage("Radim", "Chyba: " + e.message, "bot");
  } finally {
    sendBtn.disabled = false;
  }
}

sendBtn.addEventListener("click", ask);
inputEl.addEventListener("keydown", e => e.key === "Enter" && ask());

// úvodní zpráva
addMessage("Radim", "Ahoj! Zeptej se mě na cokoliv ohledně obce Radim.", "bot");
addAiNote();
</script>

</body>
</html>
