<!doctype html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Asistent obce Radim</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; background: #f6f7f9; }
    .wrap { max-width: 900px; margin: 0 auto; padding: 24px; }
    h1 { margin: 0 0 16px; font-size: 44px; letter-spacing: -0.5px; }
    .card { background: #fff; border: 1px solid #e7e9ee; border-radius: 14px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,.04); }
    .chat { display: flex; flex-direction: column; gap: 10px; min-height: 220px; }
    .msg { padding: 10px 12px; border-radius: 12px; border: 1px solid #e7e9ee; white-space: pre-wrap; }
    .me { background: #eef6ff; align-self: flex-start; }
    .bot { background: #f7f7f7; align-self: flex-start; }
    .row { display: flex; gap: 10px; margin-top: 14px; }
    input { flex: 1; padding: 12px 12px; border-radius: 12px; border: 1px solid #cfd6e4; font-size: 16px; }
    button { padding: 12px 14px; border-radius: 12px; border: 0; background: #111827; color: #fff; font-weight: 600; cursor: pointer; }
    button:disabled { opacity: .6; cursor: not-allowed; }
    .hint { margin-top: 10px; color: #6b7280; font-size: 13px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Asistent obce Radim</h1>

    <div class="card">
      <div id="chat" class="chat"></div>

      <div class="row">
        <input id="q" type="text" placeholder="NapiÅ¡te dotaz..." autocomplete="off" />
        <button id="send">Odeslat</button>
      </div>

      <div class="hint">
        Tip: zkus â€žKdy jsou ÃºÅ™ednÃ­ hodiny obce Radim?â€œ
      </div>
    </div>
  </div>

  <script>
    const chatEl = document.getElementById("chat");
    const inputEl = document.getElementById("q");
    const sendBtn = document.getElementById("send");

    function addMessage(who, text, cls) {
      const div = document.createElement("div");
      div.className = "msg " + cls;
      div.textContent = `${who}: ${text}`;
      chatEl.appendChild(div);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    async function ask() {
      const query = inputEl.value.trim();
      if (!query) return;

      addMessage("Vy", query, "me");
      inputEl.value = "";
      inputEl.focus();
      sendBtn.disabled = true;

      try {
        const res = await fetch("/.netlify/functions/search", {
          method: "POST",
          headers: { "content-type": "application/json" },
          // ðŸ”´ KLÃÄŒOVÃ FIX â€“ backend ÄekÃ¡ "message"
          body: JSON.stringify({ message: query })
        });

        const raw = await res.text();
        let data;
        try { data = JSON.parse(raw); }
        catch {
          throw new Error("Server nevrÃ¡til JSON: " + raw.slice(0, 200));
        }

        if (!res.ok || !data.ok) {
          addMessage("Radim", data?.error || `Chyba serveru (${res.status})`, "bot");
          return;
        }

        addMessage("Radim", data.answer || "(prÃ¡zdnÃ¡ odpovÄ›Ä)", "bot");

      } catch (e) {
        addMessage("Radim", "Chyba: " + (e?.message || e), "bot");
      } finally {
        sendBtn.disabled = false;
      }
    }

    sendBtn.addEventListener("click", ask);
    inputEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") ask();
    });

    addMessage("Radim", "Ahoj! Zeptej se mÄ› na cokoliv ohlednÄ› obce Radim.", "bot");
  </script>
</body>
</html>
